<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" data-namespace-typo3-fluid="true">
<f:layout name="Module" />

<f:section name="Content">
    <h1><f:translate key="module.title" /></h1>

    <f:flashMessages />

    <div class="card mb-4">
        <div class="card-header">
            <strong><f:translate key="create.title" /></strong>
        </div>
        <div class="card-body">
            <f:form action="create" method="post" objectName="patternEntry">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label" for="firewall-kind">
                            <f:translate key="field.kind" />
                        </label>
                        <f:form.select class="form-select" id="firewall-kind" property="kind" required="1">
                            <f:for each="{kinds}" as="kind">
                                <f:form.select.option value="{kind}">
                                    <f:translate key="kind.{kind}" />
                                </f:form.select.option>
                            </f:for>
                        </f:form.select>
                        <small class="form-text text-muted">
                            <f:translate key="field.kind.help" />
                        </small>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label" for="firewall-value">
                            <f:translate key="field.value" />
                        </label>
                        <f:form.textfield class="form-control" id="firewall-value" property="value" required="1" />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label" for="firewall-target">
                            <f:translate key="field.target" />
                        </label>
                        <f:form.textfield class="form-control" id="firewall-target" property="target" placeholder="header name for header_*" />
                        <small class="form-text text-muted">
                            <f:translate key="field.target.help" />
                        </small>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label" for="firewall-expiresAt">
                            <f:translate key="field.expiresAt" />
                        </label>
                        <f:form.textfield class="form-control" id="firewall-expiresAt" property="expiresAt" type="datetime-local" step="1"
                            value="{f:if(condition: pattern.expiresAt, then: '{pattern.expiresAt -> f:format.date(format: \"Y-m-d\\TH:i:s\")}', else: '')}" />
                        <small class="form-text text-muted">
                            <f:translate key="field.expiresAt.help" />
                        </small>
                    </div>
                </div>
                <div class="mt-3">
                    <f:form.submit class="btn btn-primary" value="{f:translate(key: 'action.add')}" />
                </div>
            </f:form>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <strong><f:translate key="list.title" /></strong>
            <f:form action="prune" method="post" class="d-inline">
                <f:form.submit class="btn btn-sm btn-secondary" value="{f:translate(key: 'action.prune')}" />
            </f:form>
        </div>
        <div class="card-body p-0">
            <table class="table table-striped table-bordered table-hover mb-0">
                <thead>
                <tr>
                    <th>#</th>
                    <th><f:translate key="field.kind" /></th>
                    <th><f:translate key="field.value" /></th>
                    <th><f:translate key="field.target" /></th>
                    <th><f:translate key="field.expiresAt" /></th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <f:if condition="{patterns}">
                    <f:then>
                        <f:for each="{patterns}" as="row" iteration="it">
                            <tr>
                                <td>{it.index}</td>
                                <td><code>{row.kind}</code></td>
                                <td><code><f:format.htmlspecialchars>{row.value}</f:format.htmlspecialchars></code></td>
                                <td><code><f:format.htmlspecialchars>{row.target}</f:format.htmlspecialchars></code></td>
                                <td>
                                    <f:if condition="{row.expiresAt}">
                                        <f:then>{row.expiresAt -> f:format.date(format:'Y-m-d H:i:s')}</f:then>
                                        <f:else>-</f:else>
                                    </f:if>
                                </td>
                                <td class="text-end">
                                    <f:form action="delete" method="post" class="d-inline">
                                        <f:form.hidden name="id" value="{row.id}" />
                                        <f:form.submit class="btn btn-sm btn-danger" value="{f:translate(key: 'action.delete')}" />
                                    </f:form>
                                </td>
                            </tr>
                        </f:for>
                    </f:then>
                    <f:else>
                        <tr>
                            <td colspan="6" class="text-center text-muted">
                                <f:translate key="list.empty" />
                            </td>
                        </tr>
                    </f:else>
                </f:if>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <strong><f:translate key="examples.title" /></strong>
        </div>
        <div class="card-body">
            <p class="text-muted">
                <f:translate key="examples.intro" />
            </p>
            <div class="table-responsive">
                <table class="table table-bordered align-middle text-center">
                    <thead class="table-light">
                        <tr>
                            <th><f:translate key="examples.table.header.kind" /></th>
                            <th><f:translate key="examples.table.header.value" /></th>
                            <th><f:translate key="examples.table.header.description" /></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><f:translate key="examples.table.ip.kind" /></td>
                            <td><code><f:translate key="examples.table.ip.value" /></code></td>
                            <td><f:translate key="examples.table.ip.description" /></td>
                        </tr>
                        <tr>
                            <td><f:translate key="examples.table.ip_cidr.kind" /></td>
                            <td><code><f:translate key="examples.table.ip_cidr.value" /></code></td>
                            <td><f:translate key="examples.table.ip_cidr.description" /></td>
                        </tr>
                        <tr>
                            <td><f:translate key="examples.table.path_prefix.kind" /></td>
                            <td><code><f:translate key="examples.table.path_prefix.value" /></code></td>
                            <td><f:translate key="examples.table.path_prefix.description" /></td>
                        </tr>
                        <tr>
                            <td><f:translate key="examples.table.path_substring.kind" /></td>
                            <td><code><f:translate key="examples.table.path_substring.value" /></code></td>
                            <td><f:translate key="examples.table.path_substring.description" /></td>
                        </tr>
                        <tr>
                            <td><f:translate key="examples.table.path_exact.kind" /></td>
                            <td><code><f:translate key="examples.table.path_exact.value" /></code></td>
                            <td><f:translate key="examples.table.path_exact.description" /></td>
                        </tr>
                        <tr>
                            <td><f:translate key="examples.table.path_regex.kind" /></td>
                            <td><code><f:translate key="examples.table.path_regex.value" /></code></td>
                            <td><f:translate key="examples.table.path_regex.description" /></td>
                        </tr>
                        <tr>
                            <td><f:translate key="examples.table.header_exact.kind" /></td>
                            <td><code><f:translate key="examples.table.header_exact.value" /></code></td>
                            <td><f:translate key="examples.table.header_exact.description" /></td>
                        </tr>
                        <tr>
                            <td><f:translate key="examples.table.header_substring.kind" /></td>
                            <td><code><f:translate key="examples.table.header_substring.value" /></code></td>
                            <td><f:translate key="examples.table.header_substring.description" /></td>
                        </tr>
                        <tr>
                            <td><f:translate key="examples.table.header_regex.kind" /></td>
                            <td><code><f:translate key="examples.table.header_regex.value" /></code></td>
                            <td><f:translate key="examples.table.header_regex.description" /></td>
                        </tr>
                        <tr>
                            <td><f:translate key="examples.table.user_agent.kind" /></td>
                            <td><code><f:translate key="examples.table.user_agent.value" /></code></td>
                            <td><f:translate key="examples.table.user_agent.description" /></td>
                        </tr>
                        <tr>
                            <td><f:translate key="examples.table.user_agent_substring.kind" /></td>
                            <td><code><f:translate key="examples.table.user_agent_substring.value" /></code></td>
                            <td><f:translate key="examples.table.user_agent_substring.description" /></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="mt-4 text-muted">
        <small>
            <strong><f:translate key="note.patternsStorage" /></strong>
        </small>
    </div>
</f:section>

</html>
